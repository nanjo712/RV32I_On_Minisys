#include "trap.h"

#define SPI_MASTER_BASE 0x10001000U

int main() {
    *(volatile uint32_t *)(SPI_MASTER_BASE + 0x00) = 0xc400; //data 11000100
    *(volatile uint32_t *)(SPI_MASTER_BASE + 0x14) = 0; //div
    *(volatile uint32_t *)(SPI_MASTER_BASE + 0x18) = 0b10000000; //ss
    *(volatile uint32_t *)(SPI_MASTER_BASE + 0x10) = 0x00000110; //ctrl
    
    while((*(volatile uint32_t *)(SPI_MASTER_BASE + 0x10) & 256) != 0);

    uint8_t rev = *(volatile uint8_t *)(SPI_MASTER_BASE + 0x00);
    for(int i = 0; i < 8; i++) {
        putch(((rev >> i) & 1) + '0');
    }
    return 0;
}